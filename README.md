# YouTube Thumbnail gRPC Service

## Описание
gRPC-сервис для загрузки превью видеороликов YouTube. При повторном запросе для одного и того же видео возвращается закэшированное изображение из SQLite.

## Особенности
- Кэширование запросов с использованием SQLite.
- Асинхронная загрузка изображений через CLI с флагом `--async`.
- Реализация с использованием `gRPC` и `Protobuf`.

---

## Установка и запуск

### Предварительные требования
- Установленный Go (версии 1.20 и выше)
- `protoc` (Protocol Buffers Compiler)
- SQLite3

### Шаги установки
Клонируйте репозиторий:  
   ```git clone <repository_url>```  
```cd thumbnail-service```  

Установите зависимости:  
```go mod tidy```  

Запуск сервера  
Запустите сервер:  
```go run cmd/server/main.go```  
Сервер начнет слушать на localhost:50051.

Запустите клиента:  
``` go run cmd/client/main.go ссылка_на_видео```  
или  
``` go run cmd/client/main.go --async ссылка_на_видео ссылка_на_видео```
После изображение скачается и его путь добавиться в бд    

### Сторонние библиотеки
"google.golang.org/grpc" - для работы и генерации gRPC  
"modernc.org/sqlite" - движок для работы с бд  
### Возможные ошибки
1. Error downloading thumbnail: read tcp: wsarecv: An existing connection was forcibly closed by the remote host.  
Причины ошибки:  
   1.Проблемы с сетью:  
      Сетевые сбои или нестабильное подключение могут вызвать такие ошибки. Это может быть связано с плохим интернет-соединением или проблемами с сервером.  
   2.Проблемы с сервером:  
      Возможно, удаленный сервер (например, YouTube или другой сервис) временно закрыл соединение из-за нагрузки или по другой причине.  
   3.Ограничения на стороне сервера:  
      Сервер может закрыть соединение из-за превышения лимитов или сессий, например, при массовых запросах или слишком частых подключениях.  
   4.Проблемы с прокси или фаерволлом:  
      Если вы используете прокси или фаервол, они могут блокировать или ограничивать подключение к удаленным хостам, что может привести к принудительному закрытию соединения.  
   5.Timeout или другие настройки сети:  
      Если ваше приложение или сервер имеет слишком короткое время ожидания (timeout), соединение может быть закрыто, если сервер не отвечает вовремя.  

2. Error downloading thumbnail: net/http: TLS handshake timeout  

   Возможные причины ошибки:  
   1.Сетевая проблема:  
      Сервер Google или ваше интернет-соединение могли временно испытывать трудности.  
      Соединение могло быть прервано из-за нестабильного Wi-Fi или потери пакетов.  
   2.Ограничения сервера:  
      Сервер (в данном случае Google) мог разорвать соединение, если обнаружил подозрительную активность или слишком частые запросы.  
      Может быть превышено ограничение скорости (rate limiting), особенно если вы отправляли много запросов за короткий промежуток времени.  
   3.Перегрузка сервера:  
      Сервер img.youtube.com может быть временно перегружен или недоступен.  
   4.Прерывание соединения:  
      Если соединение долго простаивало, сервер мог разорвать его по тайм-ауту.  
   5.SSL/TLS ошибка:  
      Неправильная настройка SSL/TLS (например, неверный сертификат или версия протокола) могла привести к закрытию соединения.  
   6.Тайм-аут запроса:  
      В вашем приложении установлен слишком короткий тайм-аут для выполнения запроса.  

### Решение

Как мы можем видеть основные проблемы связаны с сетью. Мои подозрения падают на сервисы ютуба, которые в последнее время работают плачевно. Для решения данных проблем попробуйте использовать быстрый VPN.

